const STORAGE_KEY = 'kanbangpt_board';
let dragged = null;

function createTaskEl(text) {
  const div = document.createElement('div');
  div.className = 'task';
  div.draggable = true;
  div.innerHTML = `
    <span class="task-text">${text}</span>
    <span class="delete-btn">âœ–</span>
  `;
  return div;
}

function saveBoard() {
  const data = {};
  document.querySelectorAll('.column').forEach(col => {
    const status = col.dataset.status;
    const tasks = [...col.querySelectorAll('.task-text')].map(t => t.textContent);
    data[status] = tasks;
  });
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

function loadBoard() {
  const data = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
  for (const [status, tasks] of Object.entries(data)) {
    const col = document.querySelector(`.column[data-status="${status}"] .tasks`);
    tasks.forEach(t => col.appendChild(createTaskEl(t)));
  }
}

document.addEventListener('click', e => {
  // Add task
  if (e.target.classList.contains('add-btn')) {
    const col = e.target.closest('.column');
    const input = document.getElementById('taskInput');
    const text = input.value || prompt('Enter task:');
    if (text && text.trim()) {
      col.querySelector('.tasks').appendChild(createTaskEl(text.trim()));
      saveBoard();
      input.value = '';
    }
  }

  // Delete task
  if (e.target.classList.contains('delete-btn')) {
    e.target.closest('.task').remove();
    saveBoard();
  }
});

document.addEventListener('dragstart', e => {
  if (e.target.classList.contains('task')) {
    dragged = e.target;
  }
});

document.addEventListener('dragover', e => {
  if (e.target.classList.contains('tasks')) {
    e.preventDefault();
  }
});

document.addEventListener('drop', e => {
  if (e.target.classList.contains('tasks')) {
    e.preventDefault();
    e.target.appendChild(dragged);
    saveBoard();
  }
});

loadBoard();
